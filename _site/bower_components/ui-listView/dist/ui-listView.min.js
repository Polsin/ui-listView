!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e){e.$root.$$phase||e.$digest()}var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),n=angular.module("ui-listView",["ui-listView.templates"]),s=/^\s*([a-zA-Z0-9]+)\s+(?:in)\s+([a-zA-Z0-9.]+(\s*[|].*$)?)/,l={preferredHeight:48},o=function(){function n(t){e(this,n),this.$scope=t,this.cells=[],this.setOptions({})}return n.$inject=["$scope"],i(n,[{key:"setOptions",value:function(e){this._addDefaultOptions(e),e.listView=this,this.options=e,this.reload([])}},{key:"requestOffsetUpdate",value:function(e){var i=this,n=this._request;n||(this._request=n={startIndex:e},this.$scope.$$postDigest(function(){i.updateRowOffsets(n.startIndex),i._request=null,t(i.$scope)})),n.startIndex=Math.min(n.startIndex,e)}},{key:"updateRowOffsets",value:function(e){e=e||0;var t,i,n=this.rows,s=n[e].offset;for(i=e;i<n.length;i++)t=n[i],t.offset=s,t.cell&&this._callCellDelegate(t.cell,"offsetDidChange",t.offset),s+=t.height;this.layout()}},{key:"updateCells",value:function(){var e,t,i,n=this.visibleRange,s=n.index,l=s+n.length,o=this.rows,r=this.cells;r.length=n.length;for(var a=s;l>a;a++)e=r[a-s],t=o[a],e||(e=r[a-s]={}),e.row&&(e.row.cell=null),t.cell=e,e.row=t,e.item=o[a].item,e.index=a,i&&(t.offset=i.offset+i.height),this._callCellDelegate(e,"rowDidChange",t),i=t}},{key:"updateAnchor",value:function(){var e=this.getScrollHeight(),t=this._lastScrollHeight;return this.anchor&&(this.anchor.updateAnchor(e),this._lastScrollHeight=e),e!==t}},{key:"updateRange",value:function(){for(var e,t,i,n=this.viewport,s=n.offset,l=s+n.height,o=this.rows,r=this._findVisibleRowIndex(s,l),a=0,u=0,h=0,c=this.visibleRange;!t||!i;)t||(e=o[r-h],(!e||e.offset+e.height<s)&&(t=!0,a=Math.max(r-h,0))),i||(e=o[r+h],(!e||e.offset>l)&&(i=!0,u=Math.min(r+h,o.length))),h++;return this.options.range=this.visibleRange={index:a,length:u-a,total:o.length},c.index!==this.visibleRange.index||c.length!==this.visibleRange.length}},{key:"setViewport",value:function(e,t){return this.viewport={offset:e,height:t},this.layout()}},{key:"layout",value:function(){return this.updateAnchor(),this.updateRange()?(this.updateCells(),!0):!1}},{key:"getScrollHeight",value:function(){var e=this.rows.length,t=this.rows[e-1];return e?t.offset+t.height:0}},{key:"getCellStyle",value:function(e){return{top:e.row.offset+"px"}}},{key:"_addDefaultOptions",value:function(e){for(var t in l)!e.hasOwnProperty(t)&&l.hasOwnProperty(t)&&(e[t]=l[t])}},{key:"reload",value:function(e){e&&e!==this.originalItems||!this.originalItems?(this._clear(),this.originalItems=e):e=this.originalItems,this.rows.length>e.length&&(this.rows.length=e.length),this._rebuildRows(e)}},{key:"_clear",value:function(e){this.originalItems=[],(!this.rows||e)&&(this.rows=[]),this.options.range=this.visibleRange={index:0,length:0}}},{key:"_rebuildRows",value:function(e){for(var t,i=0,n=this.rows,s=0;s<e.length;s++)t=n[s],t||(t=n[s]={height:this.options.preferredHeight,offset:i}),t.index=s,t.item=e[s],t.cell=null,i+=t.height}},{key:"_findVisibleRowIndex",value:function(e,t){var i,n=this.visibleRange,s=this.rows,l=Math.floor(n.index+n.length/2),o=0,r=s.length;for(l>s.length-1&&(l=Math.max(s.length-1,0));r>=o&&s[l];){if(i=s[l],i.offset+i.height<e)o=l+1;else{if(!(i.offset>t))break;r=l-1}l=o+Math.round((r-o)/2)}return l}},{key:"_callCellDelegate",value:function(e,t,i,n,s){var l=e.delegate;l&&l[t](i,n,s)}}]),n}();n.controller("UIListView",o),n.directive("uiListView",["$rootScope","$parse",function(e,i){return{templateUrl:"ui-listView.tpl.html",replace:!0,transclude:!0,scope:{options:"="},controller:"UIListView",controllerAs:"listView",require:"uiListView",compile:function(e,n){var l=s.exec(n.uiListView);if(!l)throw Error('Invalid expression.  It must be in the form "item in Array" ');var o=l[1],r=i(l[2]);return function(e,i,n,s){function l(){var e=h.scrollTop;return s.setViewport(e,h.clientHeight)}function a(){l()&&(c=!0,t(e),c=!1),clearTimeout(f),f=setTimeout(function(){l(),t(e)})}function u(){l(),t(e)}var h=i[0];s.itemIdentifier=o,e.$watch("options",function(e){s.setOptions(e||{})});var c,f;e.$watchCollection(function(){return c?s.originalItems:r(e.$parent)},function(e){s.reload(e),l()}),e.$watch(function(){return i[0].clientHeight},function(){l()}),i[0].addEventListener("scroll",a,!1),window.addEventListener("resize",u),e.$on("$destroy",function(){window.removeEventListener("resize",u)})}}}}]),angular.module("ui-listView.templates",[]).run(["$templateCache",function(e){e.put("ui-listView.tpl.html",'<div class="ui-list-view">\n    <div class="ui-list-view-cell" ui-list-view-cell ng-repeat="cell in listView.cells">\n        <div class="ui-list-view-cell-content"></div>\n    </div>\n    <div class="ui-list-view-anchor" ui-list-view-anchor></div>\n</div>')}]),angular.module("ui-listView").directive("uiListViewAnchor",function(){return{require:"^uiListView",link:function(e,t,i,n){var s=t[0];n.anchor={updateAnchor:function(e){s.style.top=e+"px"}}}}}),angular.module("ui-listView").directive("uiListViewCell",function(){return{require:"^uiListView",link:function(e,t,i,n,s){function l(e){u.style.top=e+"px"}function o(){var e=u.clientHeight,t=h.row;e!==t.height&&(t.height=e,n.requestOffsetUpdate(t.index))}function r(e){a[n.itemIdentifier]=e.item,a.$index=e.index,a.$first=0===e.index,a.$last=e.index===n.rows.length-1,l(e.offset)}var a,u=t[0],h=e.cell;s(function(e,i){var n=t.children();a=i,r(h.row),n.empty(),n.append(e)}),e.$watch(function(){return h.row.index+"-"+u.clientHeight},function(){o()}),h.delegate={rowDidChange:r,offsetDidChange:l},r(h.row)}}})}();