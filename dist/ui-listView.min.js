!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();angular.module("sl.ui-listView",["sl.ui-listView.templates"]).directive("uiListView",["$rootScope","$parse",function(i,n){function l(e){e.$root.$$phase||e.$digest()}var s=/([\s\S]+?)\s+(?:in)\s+([\s\S]+?)\s*$/,r={style:"default"},o=function(){function i(t){e(this,i),this.$scope=t,this.cells=[],this.preferredHeight=48,this._clear()}return i.$inject=["$scope"],t(i,[{key:"requestOffsetUpdate",value:function(e){var t=this,i=this._request;i||(this._request=i={startIndex:e},this.$scope.$$postDigest(function(){t.updateRowOffsets(i.startIndex),t._request=null,l(t.$scope)})),i.startIndex=Math.min(i.startIndex,e)}},{key:"updateRowOffsets",value:function(e){e=e||0;var t,i,n=this.rows,l=n[e].offset;for(i=e;i<n.length;i++)t=n[i],t.offset=l,t.cell&&this._callCellDelegate(t.cell,"offsetDidChange",t.offset),l+=t.height;this.layout()}},{key:"updateCells",value:function(){var e,t,i,n=this.visibleRange,l=n.index,s=l+n.length,r=this.rows,o=this.cells;o.length=n.length;for(var a=l;s>a;a++)e=o[a-l],t=r[a],e||(e=o[a-l]={}),e.row&&(e.row.cell=null),t.cell=e,e.row=t,e.item=r[a].item,e.index=a,i&&(t.offset=i.offset+i.height),this._callCellDelegate(e,"rowDidChange",t),i=t}},{key:"updateAnchor",value:function(){var e=this.getScrollHeight(),t=this._lastScrollHeight;return this.anchor&&(this.anchor.updateAnchor(e),this._lastScrollHeight=e),e!==t}},{key:"updateRange",value:function(){for(var e,t,i,n=this.viewport,l=n.offset,s=l+n.height,r=this.rows,o=this._findVisibleRowIndex(l,s),a=0,u=0,h=0,c=this.visibleRange;!t||!i;)t||(e=r[o-h],(!e||e.offset+e.height<l)&&(t=!0,a=Math.max(o-h,0))),i||(e=r[o+h],(!e||e.offset>s)&&(i=!0,u=Math.min(o+h,r.length))),h++;return this.visibleRange={index:a,length:u-a},c.index!==this.visibleRange.index||c.length!==this.visibleRange.length}},{key:"setViewport",value:function(e,t){return this.viewport={offset:e,height:t},this.layout()}},{key:"layout",value:function(){return this.updateAnchor(),this.updateRange()?(this.updateCells(),!0):!1}},{key:"getScrollHeight",value:function(){var e=this.rows.length,t=this.rows[e-1];return e?t.offset+t.height:0}},{key:"getCellStyle",value:function(e){return{top:e.row.offset+"px"}}},{key:"_reload",value:function(e){this._clear(),e?this.originalItems=e:e=this.originalItems,this.rows.length>e.length&&(this.rows.length=e.length),this.cells.length=e.length,this._rebuildRows(e)}},{key:"_clear",value:function(e){this.originalItems=[],(!this.rows||e)&&(this.rows=[]),this.visibleRange={index:0,length:0}}},{key:"_rebuildRows",value:function(e){for(var t,i=0,n=this.rows,l=0;l<e.length;l++)t=n[l],t||(t=n[l]={height:this.preferredHeight,offset:i}),t.index=l,t.item=e[l],t.cell=null,i+=t.height}},{key:"_findVisibleRowIndex",value:function(e,t){var i,n=this.visibleRange,l=this.rows,s=Math.floor(n.index+n.length/2),r=0,o=l.length;for(s>l.length-1&&(s=Math.max(l.length-1,0));o>=r&&l[s];){if(i=l[s],i.offset+i.height<e)r=s+1;else{if(!(i.offset>t))break;o=s-1}s=r+Math.round((o-r)/2)}return s}},{key:"_callCellDelegate",value:function(e,t,i,n,l){var s=e.delegate;s&&s[t](i,n,l)}}]),i}();return{templateUrl:"ui-listView.tpl.html",replace:!0,transclude:!0,scope:{options:"="},controller:o,controllerAs:"listView",require:"uiListView",compile:function(e,t){var i=s.exec(t.uiListView);if(!i)throw Error('Invalid expression.  It must be in the form "item in Array" ');var o=i[1],a=n(i[2]);return function(e,t,i,n){function s(){var e=f.scrollTop;return n.setViewport(e,f.clientHeight)}function u(e,i){i&&i.style&&t.removeClass("ui-list-view-"+i.style),e.style&&t.addClass("ui-list-view-"+e.style)}function h(){s()&&(d=!0,l(e),d=!1),clearTimeout(g),g=setTimeout(function(){s(),l(e)})}function c(){s(),l(e)}var f=t[0];n.itemIdentifier=o,e.$watch("options",function(e,t){e=angular.extend(angular.copy(r),e||{}),e.listView=n,n.options=e,u(e,t),n._reload()});var d,g;e.$watchCollection(function(){return d?n.originalItems:a(e.$parent)},function(e){n._reload(e),s()}),e.$watch(function(){return t[0].clientHeight},function(){s()}),t[0].addEventListener("scroll",h,!1),window.addEventListener("resize",c),e.$on("$destroy",function(){window.removeEventListener("resize",c)})}}}}]).directive("uiListViewCell",function(){return{require:"^uiListView",link:function(e,t,i,n,l){function s(e){u.style.top=e+"px"}function r(){var e=u.clientHeight,t=h.row;e!==t.height&&(t.height=e,n.requestOffsetUpdate(t.index))}function o(e){a[n.itemIdentifier]=e.item,s(e.offset)}var a,u=t[0],h=e.cell;l(function(e,i){var n=t.children();a=i,o(h.row),n.empty(),n.append(e)}),e.$watch(function(){return h.row.index+"-"+u.clientHeight},function(){r()}),h.delegate={rowDidChange:o,offsetDidChange:s},o(h.row)}}}).directive("uiListViewAnchor",function(){return{require:"^uiListView",link:function(e,t,i,n){var l=t[0];n.anchor={updateAnchor:function(e){l.style.top=e+"px"}}}}}),angular.module("sl.ui-listView.templates",[]).run(["$templateCache",function(e){e.put("ui-listView.tpl.html",'<div class="ui-list-view">\n    <div class="ui-list-view-cell" ui-list-view-cell ng-repeat="cell in listView.cells">\n        <div class="ui-list-view-cell-content"></div>\n    </div>\n    <div class="ui-list-view-anchor" ui-list-view-anchor></div>\n</div>')}])}();